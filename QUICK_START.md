# Quick Start: Using the Syntax Highlighting Fix

## What Was Fixed

The syntax highlighting wasn't working in Zed because the `queries/highlights.scm` file had incorrect patterns that didn't match the actual tree structure generated by the tree-sitter grammar.

### Key Issues Fixed:
1. ✅ Fixed `parameter_name` highlighting (was trying to match non-existent child nodes)
2. ✅ Added highlighting for Antlers delimiters (`{{`, `}}`, `{{#`, etc.)
3. ✅ Reorganized queries for proper precedence
4. ✅ Added PHP echo content injection for syntax highlighting

## For Zed Extension Users

If you're using a Zed extension that depends on this tree-sitter grammar:

### 1. Update the Grammar

Make sure your Zed extension is using the latest version of this grammar with the fixed `queries/highlights.scm` file.

### 2. Rebuild the Extension

In your Zed extension directory:

```bash
# If you have the extension as a dependency
npm update tree-sitter-antlers

# Or if you're developing the extension
cd /path/to/zed-extension
npm install
```

### 3. Restart Zed

After updating, restart Zed to pick up the new highlighting queries.

## Testing the Fix

Open an Antlers template in Zed and verify:

- ✅ **Delimiters** (`{{`, `}}`) are highlighted
- ✅ **Variables** like `{{ title }}` are colored
- ✅ **Tags** like `{{ collection:blog }}` show tags as functions
- ✅ **Modifiers** like `{{ title | upper }}` are highlighted
- ✅ **Comments** `{{# comment #}}` are grayed out
- ✅ **Strings** and **numbers** have distinct colors
- ✅ **Keywords** like `if`, `else`, `unless` are highlighted
- ✅ **HTML content** outside Antlers tags is highlighted as HTML
- ✅ **PHP content** in `{{? ?}}` and `{{$ $}}` blocks is highlighted as PHP

## Example Template

Create a test file with this content:

```antlers
{{# This is a comment #}}

<h1>{{ title }}</h1>

{{ if show_content }}
  <p>{{ content | markdown }}</p>
{{ else }}
  <p>No content available</p>
{{ /if }}

{{ collection:blog limit="5" sort="date:desc" }}
  <article>
    <h2>{{ title | upper }}</h2>
    <p>{{ excerpt }}</p>
  </article>
{{ /collection:blog }}

{{? $custom = someFunction(); ?}}
{{$ echo $custom $}}
```

All the syntax above should now be properly highlighted!

## Files Changed

- `queries/highlights.scm` - **Completely rewritten** with correct node patterns
- `queries/injections.scm` - Added PHP echo content injection
- `SYNTAX_HIGHLIGHTING_FIX.md` - Detailed documentation of the fix

## Troubleshooting

### Still No Highlighting?

1. **Check the extension is using the latest grammar**:
   - Look at your Zed extension's `package.json` or dependency files
   - Ensure it's pulling from this repository or npm package

2. **Verify file extension**:
   - Files should have `.antlers.html` or `.antlers.php` extension
   - Check Zed's language settings to ensure the extension is registered

3. **Check Zed's developer console**:
   - Look for any tree-sitter parsing errors
   - Verify the grammar is loading correctly

4. **Clear Zed's cache**:
   - Sometimes Zed caches old grammar files
   - Try restarting Zed completely

### Partial Highlighting?

If only some elements are highlighted:
- Your theme might not support all capture names
- Try a different Zed theme to verify
- Check that your theme supports: `@function`, `@variable`, `@keyword`, `@punctuation.special`

## For Grammar Developers

If you're working on the grammar itself:

```bash
# Generate the parser
npx tree-sitter generate

# Test the grammar
npx tree-sitter test

# Test highlighting on a specific file
npx tree-sitter highlight test_simple.antlers.html
```

## Technical Details

The fix ensures that highlight queries match the actual AST node structure:

- Terminal tokens (created with `token()`) don't have child nodes
- Field selectors (`method: (identifier)`) provide precise matching
- Query order matters for proper precedence
- All capture names follow tree-sitter conventions

For more technical details, see `SYNTAX_HIGHLIGHTING_FIX.md`.

## Need Help?

If syntax highlighting still isn't working after following these steps:

1. Check that your Zed extension's `extension.json` or `extension.toml` properly references this grammar
2. Verify the `tree-sitter.json` configuration is correct
3. Make sure the compiled parser (`src/parser.c`) is up to date
4. Check Zed's extension documentation for language grammar integration

## Summary

The syntax highlighting should now work correctly in Zed! The main issue was that the highlight queries were trying to match tree nodes that didn't exist in the actual parsed structure. This has been fixed by aligning the queries with the grammar's actual output.